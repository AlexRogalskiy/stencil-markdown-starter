<h1 id="testing">Testing</h1>
<p>Stencil makes it easy to unit test your component using Jest and the Stencil unit testing framework.
The testing framework requires very little configuration and has a minimal API consisting of two functions:
<code>render()</code> and <code>flush()</code>. The Stencil unit testing framework can be used to test the rendering of the component
as well as the methods defined on the component class.</p>
<h2 id="testing-config">Testing Config</h2>
<p>Allowing a Stencil component project to run unit tests requires a small amount of configuration in the <code>package.json</code>
file. All of this configuration is included with the Stencil App Starter and the Stencil Component Starter so if you
use one of those templates to start your project, you should not have to add anything. This information is presented
here primarily for informational purposes.</p>
<p>Jest is installed as a development dependency:</p>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx">  <span class="token string">"devDependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
      <span class="token string">"@types/jest"</span><span class="token punctuation">:</span> <span class="token string">"^21.1.1"</span><span class="token punctuation">,</span>
      <span class="token string">"jest"</span><span class="token punctuation">:</span> <span class="token string">"^21.2.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
</highlight-code-line>
<p>NPM scripts are set up in order to run the tests:</p>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx">  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
      <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"jest --no-cache"</span><span class="token punctuation">,</span>
      <span class="token string">"test.watch"</span><span class="token punctuation">:</span> <span class="token string">"jest --watch --no-cache"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
</highlight-code-line>
<p>Jest is configured to find test files and to use the Stencil preprocessor script to compile the sources:</p>

<highlight-code-line >
  <pre class="language-json"><code class="language-json">  <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"transform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"^.+\\.(ts|tsx)$"</span><span class="token operator">:</span> <span class="token string">"&lt;rootDir>/node_modules/@stencil/core/testing/jest.preprocessor.js"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"testRegex"</span><span class="token operator">:</span> <span class="token string">"(/__tests__/.*|\\.(test|spec))\\.(tsx?|jsx?)$"</span><span class="token punctuation">,</span>
      <span class="token property">"moduleFileExtensions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"ts"</span><span class="token punctuation">,</span>
        <span class="token string">"tsx"</span><span class="token punctuation">,</span>
        <span class="token string">"js"</span><span class="token punctuation">,</span>
        <span class="token string">"json"</span><span class="token punctuation">,</span>
        <span class="token string">"jsx"</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span></code></pre>
</highlight-code-line>
<h2 id="component-rendering-tests">Component Rendering Tests</h2>
<p>The Stencil testing framework API contains two functions that are used to render components for testing:</p>
<ul>
<li><p><code>render({ components: [], html: string })</code> - The <code>render()</code> function takes a list of components and an HTML snippet
and returns the promise of the rendered HTML element.</p>
</li>
<li><p><code>flush(element)</code> - The <code>flush()</code> function is used to refresh the rendering of an element after property changes are made.
This function returns a promise that is resolved when the flush is complete.</p>
</li>
</ul>
<p>Both of these function operate asynchronously.</p>
<p>A common testing pattern when rendering is to <code>render()</code> the component in the <code>beforeEach()</code> for a suite of tests. Each
test case then modifies the element and uses <code>flush(element)</code> to refresh the node.</p>
<h3 id="rendering-a-component">Rendering a Component</h3>
<p>Use the <code>render()</code> function to initially render a component.</p>
<p>This function takes a configuration object with two parameters:</p>
<ul>
<li><p><code>components</code>: a list of components the renderer needs to know about. Generally, this only needs to contain the
component being tested. Child components can also be included if you need to have them rendered for your test
but this is not a requirement otherwise.</p>
</li>
<li><p><code>html</code>: an HTML snippet used to render the component. Usually this just looks like <code>&lt;my-component&gt;&lt;/my-component&gt;</code>.</p>
</li>
</ul>
<p>This function returns a promise that is resolved with the rendered HTML element.</p>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx"><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  element <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">[</span>MyName<span class="token punctuation">]</span><span class="token punctuation">,</span>
    html<span class="token punctuation">:</span> <span class="token string">'&lt;my-name>&lt;/my-name>'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</highlight-code-line>
<h3 id="refreshing-a-component">Refreshing a Component</h3>
<p>Use the <code>flush()</code> function to re-render the node as needed. This is typically done after changing property values
on the component.</p>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should work with both the first and the last name'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  element<span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token string">'Peter'</span>
  element<span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token string">'Parker'</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">flush</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Hello, my name is Peter Parker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</highlight-code-line>
<h3 id="examining-the-element">Examining the Element</h3>
<p>Since the rendered element is an HTMLElement, you can use methods and properties from the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">HTMLElement interface</a> in order to examine the
contents of the element.</p>
<p>Let&#39;s say that instead of printing the first and last names, our component had to split the names apart on spaces
and print a list of each part of the name. We could write a rendering test for that as such:</p>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should least each part of the name breaking on spaces'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      element<span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token string">'Pasta Primavera'</span><span class="token punctuation">;</span>
      element<span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token string">'O Shea Buttersworth'</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">flush</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Pasta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Primavera'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Shea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Buttersworth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</highlight-code-line>
<p>Anything that you can use on an <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">HTMLElement</a> you can use in the tests.</p>
<h2 id="component-method-tests">Component Method Tests</h2>
<p>To test the component&#39;s methods, instantiate an instance of the component and call the methods.</p>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return an empty string if there is no first or last name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> myName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>myName<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</highlight-code-line>

<highlight-code-line >
  <pre class="language-tsx"><code class="language-tsx"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return a formatted string if there is no first or last name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> myName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myName<span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token string">'Lucas'</span><span class="token punctuation">;</span>
  myName<span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token string">'Kalrickson'</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>myName<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'Kalrickson, Lucas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</highlight-code-line>
<p><stencil-route-link url="/docs/context" router="#router" custom="true">
  <button class="pull-left btn btn--secondary">
    Back
  </button>
</stencil-route-link></p>
<p><stencil-route-link url="/docs/router" custom="true">
  <button class="pull-right btn btn--primary">
    Next
  </button>
</stencil-route-link></p>
